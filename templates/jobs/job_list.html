{% extends 'mainpages/base.html' %}
{% load static %}

{% block content %}
<style>
/* Enhanced CSS Variables */
:root {
  --primary-blue: #3b82f6;
  --primary-blue-dark: #2563eb;
  --accent-orange: #f97316;
  --accent-orange-dark: #ea580c;
  --success-green: #10b981;
  --text-dark: #111827;
  --text-medium: #374151;
  --text-light: #6b7280;
  --text-white: #ffffff;
  --background-white: #ffffff;
  --background-gray: #f9fafb;
  --background-gray-light: #f3f4f6;
  --border-color: #e5e7eb;
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

/* Global Styles */
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background-color: var(--background-gray);
  margin: 0;
  padding: 0;
}

/* Hero Section */
.hero-section {
  background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
  color: var(--text-white);
  padding: 3rem 0;
  text-align: center;
}

.hero-title {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.hero-subtitle {
  font-size: 1.125rem;
  opacity: 0.9;
  margin-bottom: 2rem;
}

/* Search Bar */
.search-container {
  max-width: 600px;
  margin: 0 auto;
  display: flex;
  background-color: var(--background-white);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: var(--shadow-lg);
}

.search-input {
  flex: 1;
  padding: 1rem 1.5rem;
  border: none;
  font-size: 1rem;
  outline: none;
  background: transparent;
}

.search-input::placeholder {
  color: var(--text-light);
}

.search-btn {
  background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-orange-dark) 100%);
  color: var(--text-white);
  border: none;
  padding: 1rem 2rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.search-btn:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

/* Main Content */
.main-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

/* Section Header */
.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.section-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-dark);
  margin: 0;
}

.section-actions {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.btn {
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  font-weight: 500;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.2s ease;
  border: 1px solid transparent;
  cursor: pointer;
  font-size: 0.875rem;
}

.btn:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
  color: var(--text-white);
}

.btn-primary:hover {
  color: var(--text-white);
}

.btn-outline {
  background-color: var(--background-white);
  color: var(--text-medium);
  border-color: var(--border-color);
}

.btn-outline:hover {
  background-color: var(--background-gray-light);
  color: var(--text-dark);
}

/* Sort Controls */
.sort-controls {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sort-label {
  font-size: 0.875rem;
  color: var(--text-medium);
  font-weight: 500;
}

.sort-select {
  padding: 0.5rem 1rem;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background-color: var(--background-white);
  color: var(--text-dark);
  font-size: 0.875rem;
  cursor: pointer;
}

.sort-select:focus {
  outline: none;
  border-color: var(--primary-blue);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Job Cards Grid */
.jobs-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
  margin-bottom: 3rem;
}

/* Job Card */
.job-card {
  background-color: var(--background-white);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: var(--shadow-sm);
  transition: all 0.3s ease;
  border: 1px solid var(--border-color);
}

.job-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}

.job-image-container {
  width: 100%;
  height: 200px;
  overflow: hidden;
  background-color: var(--background-gray-light);
  position: relative;
}

.job-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.job-card:hover .job-image {
  transform: scale(1.05);
}

.no-image {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--text-light);
  font-size: 0.875rem;
}

.no-image i {
  font-size: 2rem;
  margin-bottom: 0.5rem;
  opacity: 0.5;
}

.job-card-content {
  padding: 1.5rem;
}

.job-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-dark);
  margin-bottom: 0.5rem;
  line-height: 1.4;
}

.job-title a {
  color: inherit;
  text-decoration: none;
  transition: color 0.2s ease;
}

.job-title a:hover {
  color: var(--primary-blue);
  text-decoration: none;
}

.job-meta {
  display: flex;
  gap: 1rem;
  margin-bottom: 1rem;
  font-size: 0.875rem;
  color: var(--text-light);
}

.job-meta span {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.job-description {
  color: var(--text-medium);
  line-height: 1.6;
  margin-bottom: 1.5rem;
  font-size: 0.875rem;
}

.job-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.job-price {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--success-green);
}

.view-details-btn {
  background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
  color: var(--text-white);
  padding: 0.5rem 1rem;
  border-radius: 6px;
  text-decoration: none;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.2s ease;
}

.view-details-btn:hover {
  color: var(--text-white);
  text-decoration: none;
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  color: var(--text-light);
}

.empty-state i {
  font-size: 4rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.empty-state h3 {
  color: var(--text-medium);
  margin-bottom: 0.5rem;
}

/* Pagination */
.pagination-container {
  display: flex;
  justify-content: center;
  margin-top: 3rem;
}

.pagination {
  display: flex;
  gap: 0.25rem;
  list-style: none;
  padding: 0;
  margin: 0;
}

.page-item {
  margin: 0;
}

.page-link {
  color: var(--text-medium);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 0.5rem 0.75rem;
  text-decoration: none;
  transition: all 0.2s ease;
  background-color: var(--background-white);
  font-size: 0.875rem;
}

.page-item.active .page-link {
  background-color: var(--primary-blue);
  border-color: var(--primary-blue);
  color: var(--text-white);
}

.page-link:hover {
  background-color: var(--primary-blue);
  color: var(--text-white);
  border-color: var(--primary-blue);
  text-decoration: none;
}

/* Responsive Design */
@media (max-width: 768px) {
  .hero-section {
    padding: 2rem 0;
  }
  
  .hero-title {
    font-size: 2rem;
  }
  
  .search-container {
    flex-direction: column;
    border-radius: 8px;
  }
  
  .search-btn {
    border-radius: 0 0 8px 8px;
  }
  
  .main-content {
    padding: 1rem;
  }
  
  .section-header {
    flex-direction: column;
    align-items: stretch;
  }
  
  .section-actions {
    justify-content: space-between;
  }
  
  .jobs-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .job-card-content {
    padding: 1rem;
  }
  
  .job-footer {
    flex-direction: column;
    gap: 1rem;
    align-items: stretch;
  }
  
  .view-details-btn {
    text-align: center;
  }
}

/* Tab Navigation */
.tab-navigation {
  display: flex;
  justify-content: center;
  margin-bottom: 2rem;
}

.custom-tabs {
  border-bottom: 2px solid var(--border-color);
  margin-bottom: 0;
  display: inline-flex;
}

.custom-tabs .nav-link {
  border: none;
  border-bottom: 3px solid transparent;
  background: none;
  color: var(--text-medium);
  font-weight: 500;
  padding: 1rem 1.5rem;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.custom-tabs .nav-link:hover {
  border-color: var(--primary-blue);
  color: var(--primary-blue);
  background: none;
}

.custom-tabs .nav-link.active {
  color: var(--primary-blue);
  border-bottom-color: var(--primary-blue);
  background: none;
}

.custom-tabs .nav-link i {
  font-size: 1rem;
}

/* Modal Styles */
.modal-content {
  border-radius: 12px;
  border: none;
  box-shadow: var(--shadow-lg);
}

.modal-header {
  border-bottom: 1px solid var(--border-color);
  padding: 1.5rem;
}

.modal-title {
  color: var(--text-dark);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.modal-body {
  padding: 1.5rem;
}

.location-options {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.location-option-btn {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  background: var(--background-white);
  cursor: pointer;
  transition: all 0.2s ease;
  width: 100%;
  text-align: left;
}

.location-option-btn:hover {
  border-color: var(--primary-blue);
  background: var(--background-gray-light);
}

.location-option-btn.manual-location {
  cursor: default;
}

.option-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
  color: var(--text-white);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.option-content {
  flex: 1;
}

.option-content h6 {
  margin: 0 0 0.25rem 0;
  color: var(--text-dark);
  font-weight: 600;
}

.manual-inputs {
  margin-top: 0.5rem;
}

.manual-inputs .form-control {
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 0.5rem 0.75rem;
}

.manual-inputs .form-control:focus {
  border-color: var(--primary-blue);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  outline: none;
}

#locationStatus .alert {
  margin: 0;
  padding: 0.75rem 1rem;
  border-radius: 6px;
  border: none;
}

.alert-info {
  background-color: rgba(59, 130, 246, 0.1);
  color: var(--primary-blue);
}

.alert-success {
  background-color: rgba(16, 185, 129, 0.1);
  color: var(--success-green);
}

.alert-danger {
  background-color: rgba(239, 68, 68, 0.1);
  color: var(--danger-red);
}

/* Advanced Search Panel */
.advanced-search-toggle {
  margin-top: 1rem;
}

.advanced-search-toggle .btn {
  background-color: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: var(--text-white);
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  transition: all 0.2s ease;
}

.advanced-search-toggle .btn:hover {
  background-color: rgba(255, 255, 255, 0.2);
  color: var(--text-white);
}

.toggle-icon {
  margin-left: 0.5rem;
  transition: transform 0.3s ease;
}

.toggle-icon.rotated {
  transform: rotate(180deg);
}

.advanced-search-panel {
  background-color: var(--background-white);
  border-radius: 12px;
  margin-top: 1rem;
  padding: 2rem;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-color);
}

.panel-header {
  text-align: center;
  margin-bottom: 2rem;
}

.panel-header h3 {
  color: var(--text-dark);
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.panel-header p {
  color: var(--text-light);
  margin: 0;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 500;
  color: var(--text-dark);
  margin-bottom: 0.5rem;
  font-size: 0.875rem;
}

.form-group label i {
  color: var(--primary-blue);
}

.form-control {
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 0.75rem 1rem;
  font-size: 0.875rem;
  transition: all 0.2s ease;
}

.form-control:focus {
  border-color: var(--primary-blue);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  outline: none;
}

.budget-range {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.budget-range .form-control {
  flex: 1;
}

.range-separator {
  color: var(--text-light);
  font-size: 0.875rem;
  font-weight: 500;
}

.advanced-search-actions {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 1px solid var(--border-color);
}

/* Distance Display */
.job-distance {
  color: var(--success-green) !important;
  font-weight: 500;
}

.job-distance i {
  color: var(--success-green);
}

/* Responsive adjustments for advanced search */
@media (max-width: 768px) {
  .advanced-search-panel {
    padding: 1rem;
  }
  
  .budget-range {
    flex-direction: column;
    align-items: stretch;
  }
  
  .range-separator {
    text-align: center;
    padding: 0.25rem 0;
  }
  
  .advanced-search-actions {
    flex-direction: column;
  }
}
</style>

<!-- Hero Section -->
<div class="hero-section">
  <div class="container">
    <h1 class="hero-title" id="hero-title">Find Your Perfect Job</h1>
    <p class="hero-subtitle" id="hero-subtitle">Discover opportunities that match your skills and location</p>
    
    <!-- Search Bar -->
    <form method="get" action="{% url 'jobs:job_list' %}" id="search-form">
      <div class="search-container">
        <input type="text" name="q" value="{{ request.GET.q|default:'' }}" placeholder="Search jobs, skills, or companies..." class="search-input" id="search-input">
        <button type="submit" class="search-btn">Search</button>
      </div>
      
      <!-- Hidden inputs to preserve tab state -->
      <input type="hidden" name="tab" id="active-tab" value="{{ request.GET.tab|default:'jobs' }}">
      
      <!-- Advanced Search Toggle -->
      <div class="advanced-search-toggle text-center mt-3">
        <button type="button" id="advanced-search-btn" class="btn btn-outline-light">
          <i class="fa fa-sliders-h"></i>
          <span>Advanced Filters</span>
          <i class="fa fa-chevron-down toggle-icon"></i>
        </button>
      </div>

      <!-- Advanced Search Panel -->
      <div id="advanced-search-panel" class="advanced-search-panel" style="display: none;">
        <div class="panel-header">
          <h3>Advanced Filters</h3>
          <p>Refine your search to find the perfect job</p>
        </div>
        <div class="row">
          <div class="col-md-6 col-lg-3">
            <div class="form-group">
              <label for="category"><i class="fa fa-tag"></i> Category</label>
              <select name="category" id="category" class="form-control">
                <option value="">All Categories</option>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"i" %}selected{% endif %}>
                  {{ category.name }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="col-md-6 col-lg-3">
            <div class="form-group">
              <label for="municipality"><i class="fa fa-city"></i> Municipality</label>
              <input type="text" name="municipality" id="municipality" value="{{ request.GET.municipality|default:'' }}" class="form-control" placeholder="Enter municipality">
            </div>
          </div>
          <div class="col-md-6 col-lg-3">
            <div class="form-group">
              <label for="barangay"><i class="fa fa-map-marker-alt"></i> Barangay</label>
              <input type="text" name="barangay" id="barangay" value="{{ request.GET.barangay|default:'' }}" class="form-control" placeholder="Enter barangay">
            </div>
          </div>
          <div class="col-md-6 col-lg-3">
            <div class="form-group">
              <label><i class="fa fa-peso-sign"></i> Budget Range</label>
              <div class="budget-range">
                <input type="number" name="min_budget" value="{{ request.GET.min_budget|default:'' }}" class="form-control" placeholder="Min ₱">
                <span class="range-separator">to</span>
                <input type="number" name="max_budget" value="{{ request.GET.max_budget|default:'' }}" class="form-control" placeholder="Max ₱">
              </div>
            </div>
          </div>
        </div>
        <div class="advanced-search-actions">
          <button type="submit" class="btn btn-primary">
            <i class="fa fa-filter"></i> Apply Filters
          </button>
          <a href="{% url 'jobs:job_list' %}" class="btn btn-outline-secondary">
            <i class="fa fa-times"></i> Clear All
          </a>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Tab Navigation -->
<div class="tab-navigation">
  <ul class="nav nav-tabs custom-tabs" id="postTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link {% if request.GET.tab != 'services' %}active{% endif %}" id="jobs-tab" data-bs-toggle="tab" data-bs-target="#jobs" type="button" role="tab" aria-controls="jobs" aria-selected="{% if request.GET.tab != 'services' %}true{% else %}false{% endif %}" data-tab-type="jobs">
        <i class="fa fa-briefcase"></i>
        Job Posts
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link {% if request.GET.tab == 'services' %}active{% endif %}" id="services-tab" data-bs-toggle="tab" data-bs-target="#services" type="button" role="tab" aria-controls="services" aria-selected="{% if request.GET.tab == 'services' %}true{% else %}false{% endif %}" data-tab-type="services">
        <i class="fa fa-tools"></i>
        Service Posts
      </button>
    </li>
  </ul>
</div>

<!-- Main Content -->
<div class="main-content">
  <!-- Tab Content -->
  <div class="tab-content" id="postTabsContent">
    <!-- Jobs Tab -->
    <div class="tab-pane fade {% if active_tab != 'services' %}show active{% endif %}" id="jobs" role="tabpanel" aria-labelledby="jobs-tab">
      <!-- Section Header -->
      <div class="section-header">
        <h2 class="section-title">Available Jobs <span class="text-muted">({{ jobs_count }})</span></h2>
        <div class="section-actions">
          {% if user.is_authenticated %}
          <a href="{% url 'jobs:job_create' %}" class="btn btn-primary">
            <i class="fa fa-plus"></i>
            Post Job
          </a>
          {% endif %}
          <button class="btn btn-outline" data-bs-toggle="modal" data-bs-target="#locationModal">
            <i class="fa fa-map-marker-alt"></i>
            Set Location
          </button>
          <div class="sort-controls">
            <span class="sort-label">Sort by:</span>
            <select class="sort-select" onchange="sortJobs(this.value)">
              <option value="date_desc" {% if request.GET.sort == 'date_desc' or not request.GET.sort %}selected{% endif %}>Newest First</option>
              <option value="date_asc" {% if request.GET.sort == 'date_asc' %}selected{% endif %}>Oldest First</option>
              <option value="budget_desc" {% if request.GET.sort == 'budget_desc' %}selected{% endif %}>Highest Budget</option>
              <option value="budget_asc" {% if request.GET.sort == 'budget_asc' %}selected{% endif %}>Lowest Budget</option>
              {% if request.GET.lat and request.GET.lng %}
              <option value="distance" {% if request.GET.sort == 'distance' %}selected{% endif %}>Nearest First</option>
              {% endif %}
            </select>
          </div>
        </div>
      </div>

      <!-- Jobs Grid -->
      <div class="jobs-grid">
        {% for job in jobs %}
        <div class="job-card">
          <div class="job-image-container">
            {% if job.jobimage_set.exists %}
            <img src="{{ job.jobimage_set.first.image.url }}" class="job-image" alt="{{ job.title }}">
            {% else %}
            <div class="no-image">
              <i class="fa fa-image"></i>
              <span>No image available</span>
            </div>
            {% endif %}
          </div>
          
          <div class="job-card-content">
            <h3 class="job-title">
              <a href="{% url 'jobs:job_detail' job.id %}">{{ job.title }}</a>
            </h3>
            
            <div class="job-meta">
              <span>
                <i class="fa fa-map-marker-alt"></i>
                {{ job.municipality }}{% if job.barangay %}, {{ job.barangay }}{% endif %}
              </span>
              <span>
                <i class="fa fa-calendar-alt"></i>
                {{ job.created_at|date:"M d, Y" }}
              </span>
              {% if job.distance_km %}
              <span class="job-distance">
                <i class="fa fa-location-arrow"></i>
                {{ job.distance_km|floatformat:1 }} km away
              </span>
              {% endif %}
            </div>
            
            <p class="job-description">{{ job.description|truncatechars:120 }}</p>
            
            <div class="job-footer">
              <div class="job-price">₱{{ job.budget|floatformat:0 }}</div>
              <a href="{% url 'jobs:job_detail' job.id %}" class="view-details-btn">
                View Details
              </a>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="empty-state">
          <i class="fa fa-briefcase"></i>
          <h3>No jobs found</h3>
          <p>Try adjusting your search criteria or check back later for new opportunities.</p>
        </div>
        {% endfor %}
      </div>

      <!-- Pagination for Jobs -->
      {% if is_paginated %}
      <div class="pagination-container">
        <nav aria-label="Job listings pagination">
          <ul class="pagination">
            {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value|urlencode }}&{% endif %}{% endfor %}page=1">
                <i class="fa fa-angle-double-left"></i>
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value|urlencode }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}">
                <i class="fa fa-angle-left"></i>
              </a>
            </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                <li class="page-item active">
                  <span class="page-link">{{ num }}</span>
                </li>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item">
                  <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value|urlencode }}&{% endif %}{% endfor %}page={{ num }}">{{ num }}</a>
                </li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value|urlencode }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}">
                <i class="fa fa-angle-right"></i>
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value|urlencode }}&{% endif %}{% endfor %}page={{ page_obj.paginator.num_pages }}">
                <i class="fa fa-angle-double-right"></i>
              </a>
            </li>
            {% endif %}
          </ul>
        </nav>
      </div>
      {% endif %}
    </div>

    <!-- Services Tab -->
    <div class="tab-pane fade {% if active_tab == 'services' %}show active{% endif %}" id="services" role="tabpanel" aria-labelledby="services-tab">
      <!-- Section Header -->
      <div class="section-header">
        <h2 class="section-title">Available Services <span class="text-muted">({{ services_count }})</span></h2>
        <div class="section-actions">
          {% if user.is_authenticated %}
          <a href="{% url 'services:servicepost_create' %}" class="btn btn-primary">
            <i class="fa fa-plus"></i>
            Post Service
          </a>
          {% endif %}
          <button class="btn btn-outline" data-bs-toggle="modal" data-bs-target="#locationModal">
            <i class="fa fa-map-marker-alt"></i>
            Set Location
          </button>
        </div>
      </div>

      <!-- Services Grid -->
      <div class="jobs-grid">
        {% for service in services %}
        <div class="job-card">
          <div class="job-image-container">
            {% with service.images.first as service_image %}
              {% if service_image %}
                <img src="{{ service_image.image.url }}" class="job-image" alt="{{ service.headline }}">
              {% else %}
              <div class="no-image">
                <i class="fa fa-tools"></i>
                <span>No image available</span>
              </div>
              {% endif %}
            {% endwith %}
          </div>
          
          <div class="job-card-content">
            <h3 class="job-title">
              <a href="{{ service.get_absolute_url }}">[Service] {{ service.headline }}</a>
            </h3>
            
            <div class="job-meta">
              <span>
                <i class="fa fa-calendar-alt"></i>
                {{ service.created_at|date:"M d, Y" }}
              </span>
              {% if service.distance %}
              <span class="job-distance">
                <i class="fa fa-location-arrow"></i>
                {{ service.distance.km|floatformat:1 }} km away
              </span>
              {% endif %}
            </div>
            
            <p class="job-description">{{ service.description|truncatechars:120 }}</p>
            
            <div class="job-footer">
              <div class="job-price">Service</div>
              <a href="{{ service.get_absolute_url }}" class="view-details-btn">
                View Details
              </a>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="empty-state">
          <i class="fa fa-tools"></i>
          <h3>No services found</h3>
          <p>Check back later for new service opportunities.</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<!-- Location Modal -->
<div class="modal fade" id="locationModal" tabindex="-1" aria-labelledby="locationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="locationModalLabel">
          <i class="fa fa-map-marker-alt"></i>
          Set Your Location
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted mb-3">Choose how you'd like to set your location to find jobs near you.</p>
        
        <div class="location-options">
          <button type="button" class="location-option-btn" onclick="getCurrentLocation()">
            <div class="option-icon">
              <i class="fa fa-crosshairs"></i>
            </div>
            <div class="option-content">
              <h6>Use Current Location</h6>
              <small class="text-muted">Automatically detect your location</small>
            </div>
          </button>
          
          <div class="location-option-btn manual-location">
            <div class="option-icon">
              <i class="fa fa-edit"></i>
            </div>
            <div class="option-content">
              <h6>Enter Manually</h6>
              <div class="manual-inputs">
                <input type="text" class="form-control mb-2" id="manualCity" placeholder="Enter city/municipality">
                <input type="text" class="form-control" id="manualBarangay" placeholder="Enter barangay (optional)">
              </div>
            </div>
          </div>
        </div>
        
        <div id="locationStatus" class="mt-3" style="display: none;">
          <div class="alert alert-info">
            <i class="fa fa-spinner fa-spin"></i>
            <span id="statusText">Getting your location...</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="applyManualLocation()">Apply Location</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Update hero text based on active tab
function updateHeroText(tabType) {
  const heroTitle = document.getElementById('hero-title');
  const heroSubtitle = document.getElementById('hero-subtitle');
  const searchInput = document.getElementById('search-input');
  
  if (tabType === 'services') {
    heroTitle.textContent = 'Find Professional Services';
    heroSubtitle.textContent = 'Discover skilled professionals ready to help with your needs';
    searchInput.placeholder = 'Search services, skills, or providers...';
  } else {
    heroTitle.textContent = 'Find Your Perfect Job';
    heroSubtitle.textContent = 'Discover opportunities that match your skills and location';
    searchInput.placeholder = 'Search jobs, skills, or companies...';
  }
}

// Handle tab switching
document.addEventListener('DOMContentLoaded', function() {
  const tabButtons = document.querySelectorAll('.nav-link[data-tab-type]');
  const activeTabInput = document.getElementById('active-tab');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const tabType = this.getAttribute('data-tab-type');
      activeTabInput.value = tabType;
      
      // Refresh the page with the selected tab
      const url = new URL(window.location);
      url.searchParams.set('tab', tabType);
      window.location.href = url.toString();
    });
  });
  
  // Call updateHeroText with current active tab on page load
  updateHeroText(activeTabInput.value);
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Existing tab switch listeners...
  const tabButtons = document.querySelectorAll('.nav-link[data-tab-type]');
  const activeTabInput = document.getElementById('active-tab');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const tabType = this.getAttribute('data-tab-type');
      activeTabInput.value = tabType;
      
      // Refresh the page with the selected tab
      const url = new URL(window.location);
      url.searchParams.set('tab', tabType);
      window.location.href = url.toString();
    });
  });
  
  // Call updateHeroText with current active tab on page load
  updateHeroText(activeTabInput.value);
});
</script>

<script>
// Update sort functionality to preserve filters and tab
function sortJobs(sortBy) {
  const url = new URL(window.location);
  url.searchParams.set('sort', sortBy);
  window.location.href = url.toString();
}

// Update location functions to preserve filters and tab
function getCurrentLocation() {
  const statusDiv = document.getElementById('locationStatus');
  const activeTab = document.getElementById('active-tab').value;
  
  statusDiv.style.display = 'block';
  statusDiv.innerHTML = '<div class="alert alert-info"><i class="fa fa-spinner fa-spin"></i> <span>Getting your location...</span></div>';

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function(position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        
        // Create URL with current filters and new location
        const url = new URL(window.location);
        url.searchParams.set('lat', lat);
        url.searchParams.set('lng', lng);
        url.searchParams.set('tab', activeTab);
        
        statusDiv.innerHTML = '<div class="alert alert-success"><i class="fa fa-check-circle"></i> <span>Location detected successfully!</span></div>';
        
        setTimeout(() => {
          const modal = bootstrap.Modal.getInstance(document.getElementById('locationModal'));
          modal.hide();
          window.location.href = url.toString();
        }, 1500);
      },
      function(error) {
        let errorMessage = 'Unable to get your location. ';
        switch(error.code) {
          case error.PERMISSION_DENIED:
            errorMessage += 'Please allow location access.';
            break;
          case error.POSITION_UNAVAILABLE:
            errorMessage += 'Location information unavailable.';
            break;
          case error.TIMEOUT:
            errorMessage += 'Location request timed out.';
            break;
          default:
            errorMessage += 'An unknown error occurred.';
            break;
        }
        
        statusDiv.innerHTML = `<div class="alert alert-danger"><i class="fa fa-exclamation-triangle"></i> <span>${errorMessage}</span></div>`;
      }
    );
  } else {
    statusDiv.innerHTML = '<div class="alert alert-danger"><i class="fa fa-exclamation-triangle"></i> <span>Geolocation is not supported by this browser.</span></div>';
  }
}

function applyManualLocation() {
  const city = document.getElementById('manualCity').value.trim();
  const barangay = document.getElementById('manualBarangay').value.trim();
  const activeTab = document.getElementById('active-tab').value;
  
  if (!city) {
    alert('Please enter a city or municipality.');
    return;
  }
  
  // Create URL with current filters and manual location
  const url = new URL(window.location);
  url.searchParams.set('municipality', city);
  if (barangay) {
    url.searchParams.set('barangay', barangay);
  }
  url.searchParams.delete('lat');
  url.searchParams.delete('lng');
  url.searchParams.set('tab', activeTab);
  
  const modal = bootstrap.Modal.getInstance(document.getElementById('locationModal'));
  modal.hide();
  window.location.href = url.toString();
}
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const toggleBtn = document.getElementById("advanced-search-btn");
  const advancedPanel = document.getElementById("advanced-search-panel");
  
  if (toggleBtn && advancedPanel) {
    toggleBtn.addEventListener("click", function() {
      // Toggle display from none to block (and vice versa)
      if (advancedPanel.style.display === "none" || advancedPanel.style.display === "") {
        advancedPanel.style.display = "block";
        // Optionally rotate a toggle icon, if present
        let icon = toggleBtn.querySelector(".toggle-icon");
        if (icon) {
          icon.classList.add("rotated");
        }
      } else {
        advancedPanel.style.display = "none";
        let icon = toggleBtn.querySelector(".toggle-icon");
        if (icon) {
          icon.classList.remove("rotated");
        }
      }
    });
  }
});
</script>

{% endblock %}