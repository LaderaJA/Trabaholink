<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Admin Dashboard{% endblock %} - Trabaholink</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Bootstrap Icons (for compatibility) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    {% load static %}
    
    <script>
        // Trabaholink Brand Colors
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'trabaholink-cyan': '#AFE4E6',
                        'trabaholink-blue': '#5271FF',
                        'trabaholink-dark-blue': '#004AAD',
                        'trabaholink-light-blue': '#84C7EE',
                    },
                    fontFamily: {
                        'fact': ['Fact Black', 'sans-serif'],
                        'domillion': ['Domillion Brush Free', 'cursive'],
                        'hitrun': ['Hit and Run', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom Trabaholink Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Smooth transitions */
        * {
            transition: all 0.2s ease;
        }
        
        /* Sidebar hover effects */
        .sidebar-link:hover {
            transform: translateX(4px);
        }
        
        /* Card hover effects */
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #5271FF;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #004AAD;
        }
        
        /* Notification badge pulse */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .notification-badge {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-50">
    
    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-0 h-screen w-64 bg-gradient-to-b from-trabaholink-dark-blue to-trabaholink-blue text-white shadow-2xl z-50 transition-all duration-300">
        <!-- Logo/Brand -->
        <div class="flex items-center justify-between p-6 border-b border-white/10">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-trabaholink-cyan rounded-lg flex items-center justify-center">
                    <i data-lucide="shield-check" class="w-6 h-6 text-trabaholink-dark-blue"></i>
                </div>
                <div id="brand-text">
                    <h1 class="text-lg font-bold">Trabaholink</h1>
                    <p class="text-xs text-trabaholink-cyan">Admin Panel</p>
                </div>
            </div>
            <button id="sidebar-toggle" class="lg:hidden text-white hover:bg-white/10 p-2 rounded-lg">
                <i data-lucide="menu" class="w-5 h-5"></i>
            </button>
        </div>
        
        <!-- Navigation -->
        <nav class="p-4 space-y-2 overflow-y-auto h-[calc(100vh-180px)]">
            <!-- Dashboard -->
            <a href="{% url 'admin_dashboard:dashboard_main' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if request.resolver_match.url_name == 'dashboard_main' %}bg-white/20{% endif %}">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span class="sidebar-text">Dashboard</span>
            </a>
            
            <!-- Users -->
            <a href="{% url 'admin_dashboard:user_list' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'user' in request.path %}bg-white/20{% endif %}">
                <i data-lucide="users" class="w-5 h-5"></i>
                <span class="sidebar-text">Users</span>
            </a>

            <!-- User Verifications -->
            <a href="{% url 'admin_dashboard:user_verification_list' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'identity-verifications' in request.path %}bg-white/20{% endif %}">
                <i data-lucide="shield-check" class="w-5 h-5"></i>
                <span class="sidebar-text">User Verifications</span>
            </a>

            <!-- Jobs -->
            <a href="{% url 'admin_dashboard:job_list' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'job' in request.path and 'admin' in request.path %}bg-white/20{% endif %}">
                <i data-lucide="briefcase" class="w-5 h-5"></i>
                <span class="sidebar-text">Job Posts</span>
            </a>
            
            <!-- Services -->
            <a href="{% url 'admin_dashboard:service_list' %}" class="sidebar-link flex items-center justify-between px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'service' in request.path and 'admin' in request.path %}bg-white/20{% endif %}">
                <div class="flex items-center space-x-3">
                    <i data-lucide="wrench" class="w-5 h-5"></i>
                    <span class="sidebar-text">Services</span>
                </div>
                {% if pending_services_count > 0 %}
                <span class="notification-badge px-2 py-1 bg-yellow-500 text-white text-xs font-bold rounded-full">
                    {{ pending_services_count }}
                </span>
                {% endif %}
            </a>
            
            <!-- Reports -->
            <a href="{% url 'admin_dashboard:report_list' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'report' in request.path %}bg-white/20{% endif %}">
                <i data-lucide="flag" class="w-5 h-5"></i>
                <span class="sidebar-text">Reports</span>
                {% if pending_reports_count > 0 %}
                <span class="notification-badge ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full">{{ pending_reports_count }}</span>
                {% endif %}
            </a>
            
            <!-- Chat Moderation -->
            <a href="{% url 'admin_dashboard:moderated_word_list' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'moderated' in request.path or 'flagged' in request.path %}bg-white/20{% endif %}">
                <i data-lucide="message-square-warning" class="w-5 h-5"></i>
                <span class="sidebar-text">Moderation</span>
            </a>
            
            <!-- Skill Verifications -->
            <a href="{% url 'admin_dashboard:skill_verification_list' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'skill-verification' in request.path %}bg-white/20{% endif %}">
                <i data-lucide="award" class="w-5 h-5"></i>
                <span class="sidebar-text">Skill Verifications</span>
                {% if pending_skills_count > 0 %}
                <span class="notification-badge ml-auto bg-yellow-500 text-white text-xs px-2 py-1 rounded-full">{{ pending_skills_count }}</span>
                {% endif %}
            </a>
            
            <!-- Announcements -->
            <a href="{% url 'admin_dashboard:admin_announcement_list' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'announcement' in request.path %}bg-white/20{% endif %}">
                <i data-lucide="megaphone" class="w-5 h-5"></i>
                <span class="sidebar-text">Announcements</span>
            </a>
            
            <!-- Admin Management (Superuser only) -->
            {% if user.is_superuser %}
            <a href="{% url 'admin_dashboard:admin_list' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'admin' in request.path %}bg-white/20{% endif %}">
                <i data-lucide="shield-check" class="w-5 h-5"></i>
                <span class="sidebar-text">Admin Management</span>
            </a>
            {% endif %}
            
            <!-- Settings -->
            <a href="{% url 'admin_dashboard:settings' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all {% if 'settings' in request.path %}bg-white/20{% endif %}">
                <i data-lucide="settings" class="w-5 h-5"></i>
                <span class="sidebar-text">Settings</span>
            </a>
            
            <hr class="my-4 border-white/10">
            
            <!-- Back to Site -->
            <a href="{% url 'jobs:home' %}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-all">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                        <span class="sidebar-text">Back to Site</span>
                    </a>
                </nav>
                
                <!-- User Profile (Bottom) -->
                <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-white/10 bg-trabaholink-dark-blue">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-trabaholink-cyan rounded-full flex items-center justify-center text-trabaholink-dark-blue font-bold">
                            {{ request.user.username.0|upper }}
                        </div>
                        <div class="flex-1 sidebar-text">
                            <p class="text-sm font-semibold">{{ request.user.get_full_name|default:request.user.username }}</p>
                            <p class="text-xs text-trabaholink-cyan">Administrator</p>
                        </div>
                        <form method="post" action="/users/logout/" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="text-white hover:text-red-300" title="Logout">
                                <i data-lucide="log-out" class="w-5 h-5"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </aside>
            
            <!-- Main Content -->
            <main id="main-content" class="ml-64 transition-all duration-300">
                <!-- Top Navbar -->
                <header class="bg-white shadow-sm sticky top-0 z-40">
                    <div class="flex items-center justify-between px-6 py-4">
                        <div class="flex items-center space-x-4">
                            <button id="mobile-menu-toggle" class="lg:hidden text-gray-600 hover:text-trabaholink-blue">
                                <i data-lucide="menu" class="w-6 h-6"></i>
                            </button>
                    <h2 class="text-2xl font-bold text-gray-800">{% block page_title %}Dashboard{% endblock %}</h2>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Search -->
                    <form method="get" class="hidden md:flex items-center bg-gray-100 rounded-lg px-4 py-2">
                        <i data-lucide="search" class="w-5 h-5 text-gray-400 mr-2"></i>
                        <input type="text" name="search" placeholder="Search users, jobs, services..." class="bg-transparent border-none outline-none text-sm w-64" value="{{ request.GET.search }}">
                    </form>
                    
                    <!-- Notifications -->
                    <a href="/notifications/" class="relative text-gray-600 hover:text-trabaholink-blue p-2 rounded-lg hover:bg-gray-100">
                        <i data-lucide="bell" class="w-6 h-6"></i>
                        {% if unread_notifications_count > 0 %}
                        <span class="absolute top-1 right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center font-bold">{{ unread_notifications_count }}</span>
                        {% endif %}
                    </a>
                    
                    <!-- User Profile Link -->
                    <a href="/users/profile/{{ request.user.pk }}/" class="flex items-center space-x-2 hover:bg-gray-100 rounded-lg px-3 py-2">
                        <div class="w-8 h-8 bg-trabaholink-blue rounded-full flex items-center justify-center text-white font-bold text-sm">
                            {{ request.user.username.0|upper }}
                        </div>
                        <span class="hidden md:block text-sm font-medium text-gray-700">{{ request.user.username }}</span>
                    </a>
                </div>
            </div>
        </header>
        
        <!-- Page Content -->
        <div class="p-6">
            <!-- Breadcrumb -->
            {% block breadcrumb %}
            <nav class="mb-6 text-sm">
                <ol class="flex items-center space-x-2 text-gray-500">
                    <li><a href="{% url 'admin_dashboard:dashboard_main' %}" class="hover:text-trabaholink-blue">Dashboard</a></li>
                    {% block breadcrumb_items %}{% endblock %}
                </ol>
            </nav>
            {% endblock %}
            
            <!-- Messages -->
            {% if messages %}
            <div class="mb-6 space-y-2" id="alert-container">
                {% for message in messages %}
                <div class="flex items-center p-4 rounded-lg transition-all duration-300 auto-dismiss-alert {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% elif message.tags == 'warning' %}bg-yellow-50 text-yellow-800 border border-yellow-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %}">
                    <i data-lucide="{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}x-circle{% elif message.tags == 'warning' %}alert-triangle{% else %}info{% endif %}" class="w-5 h-5 mr-3 flex-shrink-0"></i>
                    <span class="flex-1">{{ message }}</span>
                    <button type="button" class="ml-3 text-current opacity-50 hover:opacity-100 transition-opacity" onclick="this.parentElement.remove()">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Main Content Block -->
            {% block content %}{% endblock %}
        </div>
    </main>
    
    <!-- Initialize Lucide Icons -->
    <script>
        lucide.createIcons();
        
        // Mobile menu toggle
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        
        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
        }
        
        if (mobileMenuToggle) {
            mobileMenuToggle.addEventListener('click', toggleSidebar);
        }
        
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', toggleSidebar);
        }
        
        // Close sidebar on mobile when clicking outside
        document.addEventListener('click', function(event) {
            if (window.innerWidth < 1024) {
                if (!sidebar.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                    sidebar.classList.add('-translate-x-full');
                }
            }
        });
        
        // Responsive sidebar
        function handleResize() {
            if (window.innerWidth < 1024) {
                sidebar.classList.add('-translate-x-full');
                mainContent.classList.remove('ml-64');
            } else {
                sidebar.classList.remove('-translate-x-full');
                mainContent.classList.add('ml-64');
            }
        }
        
        window.addEventListener('resize', handleResize);
        handleResize();
        
        // Auto-dismiss alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.auto-dismiss-alert');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    // Fade out animation
                    alert.style.opacity = '0';
                    alert.style.transform = 'translateX(100%)';
                    
                    // Remove from DOM after animation
                    setTimeout(function() {
                        alert.remove();
                        
                        // Remove container if no alerts left
                        const container = document.getElementById('alert-container');
                        if (container && container.children.length === 0) {
                            container.remove();
                        }
                    }, 300);
                }, 5000); // 5 seconds
            });
            
            // Re-initialize Lucide icons for close buttons
            lucide.createIcons();
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
